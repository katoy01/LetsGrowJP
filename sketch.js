// graphic to hold all of our tiles as one big image
let tilesetArtwork, playerArtwork;

// the size of each tile (32 x 32 square)
let worldTileSize = 32;

// ofsets for screen scrolling
let offsetX = 0;
let offsetY = 0;
let minOffsetX, minOffsetY;

let world = [
    //                          10                            20                            30                            40                            50                            60                            70                            80
    [13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13],
    //                                           10                                                20                                                 30                                               40                                      50                                       60                                      70                                      80
    [13, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2222, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 2812, 1640, 1640, 1640, 1640, 1640, 1640, 1640, 1640, 1640, 1640, 1640, 1640, 1640, 13],
    [13, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2370, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 2812, 1640, 1640, 1640, 1640, 1640, 1640, 1640, 1640, 1640, 1640, 1640, 1640, 1640, 13],

    [13, 2369, 2521, 2517, 2517, 2517, 2517, 2517, 2517, 2517, 2517, 2517, 2517, 2517, 2517, 2517, 2517, 2517, 2517, 2517, 2517, 2517, 2517, 2517, 2517, 2517, 2517, 2517, 2517, 2517, 2517, 2517, 2517, 2517, 2517, 2517, 2517, 2517, 2517, 2518, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 2812, 3848, 3849, 1640, 1640, 3848, 3849, 1640, 1640, 3848, 3849, 1640, 1640, 1640, 13],
    //                                           10                                                20                                                 30                                             40                                        50                                         60                                          70                                          80
    [13, 2369, 2370, 3850, 3851, 3855, 4782, 4296, 4297, 4297, 4297, 4297, 4297, 4297, 4297, 4297, 4297, 4297, 4297, 4297, 4297, 4297, 4297, 4297, 4297, 4297, 4297, 4297, 4297, 4297, 4297, 4297, 4297, 4297, 4297, 4298, 607, 4005, 4006, 607, 607, 607, 3850, 3851, 607, 607, 607, 607, 607, 607, 607, 4003, 607, 4002, 607, 607, 607, 607, 607, 607, 2630, 2631, 607, 607, 607, 2812, 3996, 3997, 1640, 1640, 3996, 3997, 1640, 1640, 3996, 3997, 1640, 1640, 1640, 13],
    //start row of farm plots 
    //                                         10                                                20                                              30                                            40                                        50                                   60                                            70                                               80
    [13, 2369, 2370, 3998, 3999, 1207, 1059, 4444, 1647, 1651, 1651, 1651, 1651, 1651, 1651, 1651, 1503, 607, 3850, 3851, 607, 607, 1647, 1651, 1651, 1651, 1651, 1651, 1651, 1651, 1651, 1503, 607, 3850, 3851, 607, 607, 1203, 1059, 607, 607, 607, 3998, 3999, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 2778, 2779, 607, 607, 607, 2960, 2961, 2961, 2961, 2961, 2961, 2961, 2961, 2961, 2961, 2961, 2377, 2369, 2369, 13],
    //                                         10                                                20                                              30                                             40                                        50                                            60                                             70                                              80
    [13, 2369, 2370, 3855, 909, 909, 1060, 4444, 1649, 1339, 1339, 1339, 1339, 1339, 1339, 1339, 1504, 607, 3998, 3999, 607, 607, 1649, 1339, 1339, 1339, 1339, 1339, 1339, 1339, 1339, 1504, 607, 3998, 3999, 607, 4152, 1205, 1060, 4152, 607, 607, 607, 607, 607, 607, 607, 3850, 3851, 607, 4151, 607, 607, 1095, 1096, 1097, 1098, 1099, 607, 607, 2778, 2779, 607, 607, 4297, 4297, 4297, 4297, 4297, 4297, 4297, 4297, 4297, 4298, 607, 607, 2812, 2369, 2369, 13],
    //                                         10                                             20                                              30                                             40                                         50                                             60                                               70                                              80
    [13, 2369, 2370, 1205, 909, 909, 1060, 4444, 1649, 1339, 1339, 1339, 1339, 1339, 1339, 1339, 1504, 607, 607, 3850, 3851, 607, 1649, 1339, 1339, 1339, 1339, 1339, 1339, 1339, 1339, 1504, 607, 607, 607, 607, 4152, 1205, 1060, 4152, 607, 607, 607, 607, 4002, 607, 607, 3998, 3999, 607, 607, 607, 607, 1243, 1244, 1245, 1246, 1247, 3072, 3073, 3074, 3075, 3076, 3077, 1207, 1207, 2584, 2585, 2586, 1207, 1207, 1697, 1697, 4446, 607, 607, 2812, 2369, 2369, 13],
    //edge row right above bpttom row of plot 
    //                                         10                                             20                                              30                                               40                                        50                                           60                                               70                                           80
    [13, 2369, 2370, 1205, 909, 909, 1060, 4444, 1649, 1339, 1339, 1339, 1339, 1339, 1339, 1339, 1504, 607, 607, 3998, 3999, 607, 1649, 1339, 1339, 1339, 1339, 1339, 1339, 1339, 1339, 1504, 607, 3850, 3851, 607, 4152, 1205, 1060, 4152, 607, 607, 4152, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 1391, 1392, 1393, 1394, 1395, 3220, 3221, 3222, 3223, 3224, 3225, 908, 908, 2732, 2733, 2734, 2882, 908, 908, 1697, 4446, 607, 607, 2812, 2369, 2369, 13],
    //end row of farm plots 
    //                                         10                                              20                                              30                                               40                                        50                                           60                                               70                                           80
    [13, 2369, 2370, 1205, 909, 909, 1060, 4444, 1501, 1502, 1502, 1502, 1502, 1502, 1502, 1502, 1500, 607, 3850, 3851, 607, 607, 1501, 1502, 1502, 1502, 1502, 1502, 1502, 1502, 1502, 1500, 607, 3998, 3999, 607, 4004, 1205, 1060, 4004, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 1539, 1540, 1541, 1542, 1543, 908, 3369, 3370, 3371, 3372, 908, 908, 908, 908, 908, 908, 908, 908, 908, 1697, 4446, 607, 607, 2812, 2369, 2369, 13],
    //^10th row
    //                                         10                                               20                                                 30                                                40                                                50                                           60                                               70                                           80
    //end corner row of fence                                     4299 is gate                                                                                                                                               4591 below                                                                                                                      1060 is side dirt
    [13, 2369, 2370, 1205, 909, 909, 1060, 4592, 4593, 4593, 4593, 4593, 4593, 4299, 4593, 4593, 4593, 4593, 3998, 3999, 4593, 4593, 4593, 4593, 4593, 4593, 4299, 4593, 4593, 4593, 4593, 4593, 4593, 4593, 4593, 4593, 4589, 1205, 1060, 4588, 4593, 4593, 4593, 4593, 4593, 4593, 4593, 4593, 4593, 4593, 4593, 4593, 4593, 1687, 1688, 1689, 1690, 1691, 908, 3517, 3518, 3519, 3520, 908, 908, 908, 908, 908, 908, 908, 908, 908, 1060, 4446, 607, 607, 2812, 2369, 2369, 13],
    //                                                                                                                                                                                                                               1546 below
    //                                         10                                               20                                               30                                              40                                         50                                        60                                      70                                           80
    [13, 2369, 2370, 1205, 909, 909, 1208, 1207, 1207, 1207, 1207, 1207, 1209, 909, 1208, 1207, 1207, 1207, 1207, 1207, 1207, 1207, 1207, 1207, 1207, 1209, 909, 1208, 1207, 1207, 1207, 1207, 1207, 1207, 1207, 1207, 1207, 1209, 1198, 1207, 1207, 3854, 3854, 4591, 908, 908, 908, 908, 908, 909, 908, 1398, 1398, 908, 908, 908, 908, 908, 908, 908, 908, 908, 908, 908, 908, 908, 908, 908, 908, 908, 908, 908, 1060, 4446, 607, 607, 2812, 2369, 2369, 13],
    //                                        10                                             20                                             30                                                40                                         50                                      60                                      70                                           80
    [13, 2369, 2370, 1205, 909, 909, 909, 3721, 3721, 3721, 3721, 3721, 909, 909, 909, 3721, 3721, 3721, 3721, 3721, 3721, 3721, 3721, 3721, 3721, 909, 909, 909, 3721, 3721, 3721, 3721, 3721, 3721, 3721, 3721, 3721, 909, 909, 909, 909, 909, 3854, 4591, 1697, 909, 909, 909, 909, 909, 909, 1545, 1546, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 1060, 4446, 607, 607, 2812, 2369, 2369, 13],
    //                                     10                                      20                                      30                                       40                                         50                                      60                                      70                                          80
    [13, 2369, 2370, 1205, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 1060, 4591, 2725, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 1060, 4446, 607, 607, 2812, 2369, 2369, 13],
    //                                     10                                      20                                      30                                       40                                         50                                      60                                      70                                          80
    [13, 2369, 2370, 1205, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 1060, 4591, 2873, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 1060, 4446, 607, 607, 2812, 2369, 2369, 13],
    //                                        10                                               20                                               30                                                40                                         50                                      60                                      70                                           80
    [13, 2369, 2370, 1205, 909, 909, 1062, 1058, 1058, 1058, 1058, 1206, 909, 1062, 1058, 1058, 1058, 1058, 1058, 1058, 1058, 1058, 1058, 1058, 1058, 1206, 909, 1062, 1058, 1058, 1058, 1058, 1058, 1058, 1058, 1058, 1058, 1058, 1206, 909, 909, 909, 1060, 4591, 1205, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 1060, 4446, 607, 607, 2812, 2369, 2369, 13],
    //                                         10                                               20                                                30                                                40                                         50                                      60                                      70                                           80
    [13, 2369, 2370, 1205, 909, 909, 1060, 4296, 4297, 4297, 4297, 4297, 4299, 4297, 4297, 4297, 4297, 4297, 4297, 3850, 3851, 4440, 4297, 4297, 4297, 4441, 4299, 4440, 4297, 4297, 4297, 4297, 4297, 4297, 4297, 4297, 4297, 4298, 1205, 909, 909, 909, 1060, 4591, 2725, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 1060, 4446, 607, 607, 2812, 2369, 2369, 13],
    //                                         10                                               20                                               30                                           40                                         50                                      60                                      70                                           80
    [13, 2369, 2370, 1205, 909, 909, 1060, 4446, 1647, 1651, 1651, 1651, 1651, 1651, 1651, 1651, 1651, 1503, 607, 3998, 3999, 607, 1647, 1651, 1651, 1651, 1651, 1651, 1651, 1651, 1651, 1651, 1503, 607, 607, 607, 607, 4446, 1205, 909, 909, 909, 1060, 4591, 2873, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 1060, 4446, 607, 607, 2812, 2369, 2369, 13],
    //                                         10                                               20                                               30                                           40                                         50                                      60                                      70                                           80    
    [13, 2369, 2370, 1205, 909, 909, 1060, 4446, 1649, 1353, 1353, 1353, 1353, 1353, 1353, 1353, 1353, 1504, 3850, 3851, 607, 607, 1649, 1353, 1353, 1353, 1353, 1353, 1353, 1353, 1353, 1353, 1504, 607, 607, 607, 607, 4446, 1205, 909, 909, 909, 1060, 4591, 1205, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 1060, 4446, 607, 607, 2812, 2369, 2369, 13],
    //                                         10                                               20                                               30                                             40                                         50                                      60                                      70                                           80    
    [13, 2369, 2370, 1205, 909, 909, 1060, 4446, 1649, 1353, 1353, 1353, 1353, 1353, 1353, 1353, 1353, 1504, 3998, 3999, 607, 607, 1649, 1353, 1353, 1353, 1353, 1353, 1353, 1353, 1353, 1353, 1504, 607, 3850, 3851, 607, 4446, 1205, 909, 909, 909, 1060, 4591, 1205, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 1060, 4446, 607, 607, 2812, 2369, 2369, 13],
    //^20th row
    //                                         10                                               20                                            30                                             40                                             50                                                60                                                70                                             80    
    [13, 2369, 2370, 1205, 909, 909, 1060, 4446, 1649, 1353, 1353, 1353, 1353, 1353, 1353, 1353, 1353, 1504, 607, 607, 607, 607, 1649, 1353, 1353, 1353, 1353, 1353, 1353, 1353, 1353, 1353, 1504, 607, 3998, 3999, 607, 4446, 1205, 909, 909, 909, 1060, 4446, 1057, 1058, 1058, 1058, 1058, 1058, 1058, 1058, 1058, 1058, 1206, 1062, 1058, 1058, 1058, 1058, 1058, 1058, 1058, 1058, 1058, 1399, 1400, 1058, 1058, 1058, 1058, 1058, 1056, 4446, 607, 607, 2812, 2369, 2369, 13],
    //                                         10                                               20                                            30                                            40                                             50                                                60                                                70                                            80    
    [13, 2369, 2370, 1205, 909, 909, 1060, 4446, 1649, 1353, 1353, 1353, 1353, 1353, 1353, 1353, 1353, 1504, 607, 607, 607, 607, 1649, 1353, 1353, 1353, 1353, 1353, 1353, 1353, 1353, 1353, 1504, 607, 607, 607, 607, 4446, 1205, 909, 909, 909, 1060, 4592, 4593, 4593, 4593, 4593, 4593, 4593, 4593, 4593, 4593, 4593, 4299, 4299, 4593, 4593, 4593, 4593, 4593, 4593, 4593, 4593, 4593, 4593, 4593, 4593, 4593, 4593, 4593, 4593, 4593, 4594, 607, 607, 2812, 2369, 2369, 13],
    //                                         10                                               20                                            30                                           40                                             50                                                60                                                70                                             80    
    [13, 2369, 2370, 1205, 909, 909, 1060, 4446, 1501, 1502, 1502, 1502, 1502, 1502, 1502, 1502, 1502, 1500, 607, 607, 607, 607, 1501, 1502, 1502, 1502, 1502, 1502, 1502, 1502, 1502, 1502, 1500, 607, 607, 607, 607, 4446, 1205, 909, 909, 909, 1208, 1207, 1207, 1207, 1207, 1207, 1207, 1207, 1207, 1207, 1207, 1207, 1209, 1208, 1207, 1207, 1207, 1207, 1207, 1207, 1207, 1207, 1207, 1207, 1207, 1207, 1207, 1207, 1207, 1207, 1207, 1059, 607, 607, 2812, 2369, 2369, 13],
    //                                         10                                                20                                               30                                           40                                        50                                       60                                     70                                           80   
    [13, 2369, 2370, 1205, 909, 909, 1060, 4592, 4593, 4593, 4593, 4593, 4593, 4593, 4593, 4593, 4593, 4593, 4593, 4593, 4593, 4593, 4593, 4593, 4593, 4593, 4593, 4593, 4593, 4593, 4593, 4593, 4593, 4593, 4593, 4593, 4593, 4594, 1205, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 1060, 607, 607, 2812, 2369, 2369, 13],
    //                                       10                                            20                                       30                                      40                                      50                                       60                                     70                                          80   
    [13, 2369, 2370, 1205, 909, 909, 1060, 607, 607, 3014, 3015, 3016, 3017, 3018, 3019, 3020, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 1205, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 1060, 607, 607, 2812, 2369, 2369, 13],
    //                                       10                                             20                                       30                                       40                                              50                                                60                                                70                                             80   
    [13, 2369, 2370, 1205, 909, 909, 1060, 607, 607, 3162, 3163, 3164, 3165, 3166, 3167, 3168, 607, 607, 4004, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 1205, 909, 909, 1062, 1058, 1058, 1058, 1058, 1058, 1058, 1058, 1058, 1058, 1058, 1058, 1058, 1058, 1058, 1058, 1058, 1058, 1058, 1058, 1058, 1058, 1058, 1058, 1058, 1058, 1058, 1058, 1058, 1058, 1058, 1058, 1056, 607, 607, 2812, 2369, 2369, 13],
    //                                       10                                             20                                         30                                       40                                          50                                      60                                      70                                         80   
    [13, 2369, 2370, 1205, 909, 909, 1060, 6958, 607, 3310, 3311, 3312, 3313, 3314, 3315, 3316, 607, 607, 607, 607, 607, 3850, 3851, 607, 607, 607, 607, 4004, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 1205, 909, 909, 1060, 607, 3850, 3851, 607, 4003, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 2812, 2369, 2369, 13],
    //                                       10                                              20                                         30                                      40                                          50                                            60                                                70                                           80   
    [13, 2369, 2370, 1205, 909, 909, 1060, 7106, 607, 3458, 3459, 3460, 3461, 3462, 3463, 3464, 607, 607, 4003, 607, 607, 3998, 3999, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 1205, 909, 909, 1060, 607, 3998, 3999, 607, 607, 607, 607, 607, 607, 607, 1802, 2087, 2087, 2087, 2087, 2087, 2087, 2087, 2087, 2087, 2087, 2087, 2087, 2087, 2087, 2087, 2087, 2087, 2087, 1946, 607, 607, 607, 607, 2812, 2369, 2369, 13],
    //                                        10                                              20                                         30                                    40                                          50                                            60                                                70                                           80   
    [13, 2369, 2370, 1205, 909, 909, 1060, 7254, 3857, 3606, 3607, 3608, 3609, 3610, 3611, 3612, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 4003, 607, 1205, 909, 909, 1060, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 1800, 1936, 1936, 1936, 1936, 1936, 1936, 1936, 1936, 1936, 1936, 1936, 1936, 1936, 1936, 1936, 1936, 1936, 1936, 1945, 607, 607, 607, 607, 2812, 2369, 2369, 13],
    //                                      10                                        20                                      30                                        40                                      50                                              60                                                70                                           80    
    [13, 2369, 2370, 1205, 909, 909, 1060, 607, 607, 607, 607, 1205, 909, 1060, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 1205, 909, 909, 1060, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 1800, 1936, 1936, 1936, 1936, 1936, 1936, 1936, 1936, 1936, 1936, 1936, 1936, 1936, 1936, 1936, 1936, 1936, 1936, 1945, 607, 607, 607, 607, 2812, 2369, 2369, 13],
    //^30th row 
    //                                        10                                               20                                                30                                                40                                       50                                              60                                                70                                             80    
    [13, 2369, 2370, 1205, 909, 909, 1208, 1207, 1207, 1207, 1207, 1209, 909, 1208, 1207, 1207, 1207, 1207, 1207, 1207, 1207, 1207, 1207, 1207, 1207, 1207, 1207, 1207, 1207, 1207, 1207, 1207, 1207, 1207, 1207, 1207, 1207, 1207, 1209, 909, 909, 1060, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 1800, 1936, 1936, 1936, 1936, 1936, 2226, 1936, 1936, 1936, 1936, 1936, 1936, 1936, 1936, 1936, 1936, 1936, 1936, 1945, 607, 3850, 3851, 607, 2812, 2369, 2369, 13],
    //                                     10                                      20                                      30                                      40                                        50                                              60                                                70                                             80    
    [13, 2369, 2370, 1205, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 1060, 6958, 607, 607, 607, 607, 607, 607, 607, 607, 607, 1800, 1936, 1936, 1936, 1936, 1936, 1936, 1936, 1936, 1936, 1936, 1936, 1936, 1936, 1936, 1936, 1936, 1936, 1936, 1945, 607, 3998, 3999, 607, 2812, 2369, 2369, 13],
    //                                      10                                      20                                      30                                      40                                         50                                              60                                                70                                           80    
    [13, 2369, 2370, 1205, 6958, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 909, 1060, 7106, 607, 607, 607, 607, 4782, 607, 607, 607, 607, 1800, 1936, 1936, 1936, 1936, 1936, 1936, 1936, 1936, 1936, 1936, 1936, 1936, 1936, 2226, 1936, 1936, 1936, 1936, 1945, 607, 607, 607, 607, 2812, 2369, 2369, 13],
    //                                      10                                      20                                      30                                      40                                         50                                              60                                                70                                           80    
    [13, 2369, 2370, 4155, 7106, 1058, 1058, 1058, 1058, 1058, 1058, 1058, 1058, 1058, 1058, 1058, 1058, 1058, 1058, 1058, 1058, 1058, 1058, 1058, 1058, 1058, 1058, 1058, 1058, 1058, 1058, 1058, 1058, 1058, 1058, 1058, 1058, 1058, 1058, 1058, 1058, 607, 7254, 607, 607, 607, 607, 607, 607, 607, 607, 607, 1800, 1936, 1936, 1936, 1936, 1936, 1936, 1936, 1936, 1936, 1936, 1936, 1936, 1936, 1936, 1936, 1936, 1936, 1936, 1945, 607, 4004, 607, 607, 2812, 2369, 2369, 13],
    //                                      10                                          20                                      30                                      40                                      50                                              60                                                70                                           80    
    [13, 2369, 2370, 607, 7254, 3856, 607, 607, 607, 3850, 3851, 607, 607, 607, 607, 607, 3850, 3851, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 1800, 1936, 1936, 1936, 1936, 1936, 1936, 1936, 1936, 1936, 1936, 1936, 1936, 1936, 1936, 1929, 1947, 1947, 1947, 1949, 607, 607, 607, 607, 2812, 2369, 2369, 13],
    //                                       10                                          20                                      30                                      40                                      50                                             60                                               70                                         80    
    [13, 2369, 2369, 2371, 2222, 4155, 607, 607, 607, 3998, 3999, 607, 607, 607, 607, 607, 3998, 3999, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 1948, 1936, 1936, 1936, 1936, 1936, 1936, 1936, 1936, 1936, 1936, 1936, 1936, 1936, 1936, 1945, 607, 607, 607, 607, 607, 607, 607, 607, 2368, 2369, 2369, 13],
    //                                          10                                                20                                                30                                                40                                             50                                            60                                               70                                               80    
    [13, 2369, 2369, 2369, 2369, 2376, 3850, 3851, 2376, 2376, 2376, 2376, 2376, 3850, 3851, 2376, 2376, 2376, 2376, 2376, 2376, 3850, 3851, 2376, 2376, 2376, 2376, 2376, 2376, 2376, 2376, 2376, 2376, 2376, 2376, 2376, 2376, 2376, 2376, 2376, 2376, 2376, 2376, 2376, 2376, 2222, 607, 607, 607, 607, 607, 607, 607, 1948, 1936, 1936, 1936, 1936, 1936, 1936, 1936, 1936, 1936, 1936, 1936, 1936, 1936, 1945, 607, 607, 2220, 2221, 2221, 2221, 2221, 2221, 2369, 2369, 2369, 13],
    //                                          10                                                20                                                30                                                40                                             50                                            60                                               70                                               80    
    [13, 2369, 2369, 2369, 2369, 2369, 3998, 3999, 2369, 2369, 2369, 2369, 2369, 3998, 3999, 2369, 2369, 4155, 2369, 2369, 2369, 3998, 3999, 2369, 4155, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2370, 607, 607, 607, 607, 4003, 607, 607, 607, 1948, 1947, 1947, 1947, 1947, 1947, 1947, 1947, 1947, 1947, 1947, 1947, 1947, 1949, 607, 607, 2368, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 13],
    //                                          10                                                20                                                30                                                40                                             50                                            60                                               70                                               80    
    [13, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2370, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 607, 2368, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 2369, 13],
    [13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13],
    //^40th row
]

// overlays for our world
let overlay = [];

let player;

// handle the tile loading and creating our player object in preload before the game can start
function preload() {
    tilesetArtwork = loadImage('./assets/global.png');
    playerArtwork = loadImage('./assets/player.png');
}


// function allDone(worldData) {
//     console.log("here");
// }

// function badStuffHappened(result) {
//     console.log(result);
// }

// create canvas & player object
function setup() {
    createCanvas(960, 480);
    background(255);

    tilesetArtwork.resize(4736, 2272);
    playerArtwork.resize(128, 256);

    // setup the world overlay
    setupOverlay();

    minOffsetX = (width) - (world[0].length * worldTileSize);
    minOffsetY = (height) - (world.length * worldTileSize);

    // create our player
    player = new Player(width / 2, height / 2);
}

function draw() {
    // draw the world and the character
    background(113, 143, 63);
    push();
    translate(offsetX, offsetY);
    drawWorld();
    pop();

    // the character will always be drawn in the middle of the screen
    player.moveAndDisplay();
}

// draw the entire world using the 2D array above
function drawWorld() {
    for (let y = 0; y < world.length; y++) {
        for (let x = 0; x < world[y].length; x++) {
            // extract the tile here
            let id = world[y][x];
            drawTile(tilesetArtwork, id, worldTileSize, worldTileSize, x * worldTileSize, y * worldTileSize);

            // also draw the overlay here
            let idOverlay = overlay[y][x];
            drawTile(tilesetArtwork, idOverlay, worldTileSize, worldTileSize, x * worldTileSize, y * worldTileSize);
        }
    }
}

// draw tile with an ID of i and position x,y
function drawTile(img, id, tileSizeX, tileSizeY, screenX, screenY) {
    // step 1: figure out how many tiles are on each row of our image
    let tilesPerRow = int(img.width / tileSizeX);

    // step 2: give the tile ID, figure out where that tile exists
    // in the source image.
    let imageX = int(id % tilesPerRow) * tileSizeX;
    let imageY = int(id / tilesPerRow) * tileSizeY;

    // step 3: draw the desired tile
    image(img, screenX, screenY, tileSizeX, tileSizeY,
        imageX, imageY, tileSizeX, tileSizeY);
}

// setup our overlay array
function setupOverlay() {
    // set up the overlay to be the same size as the world, just filled with -1's
    for (let y = 0; y < world.length; y++) {
        overlay.push([]);
        for (let x = 0; x < world[y].length; x++) {
            overlay[y].push(-1);
        }
    }
}

// obtain the tile ID at a given screen coordinate
function getWorldTileAtPosition(screenX, screenY) {
    // convert screen coordinates into array coordinates
    let arrayX = int((screenX - offsetX) / worldTileSize);
    let arrayY = int((screenY - offsetY) / worldTileSize);

    let id = world[arrayY][arrayX];
    return id;
}

function getOverlayTileAtPosition(screenX, screenY) {
    // convert screen coordinates into array coordinates
    let arrayX = int((screenX - offsetX) / worldTileSize);
    let arrayY = int((screenY - offsetY) / worldTileSize);

    let id = overlay[arrayY][arrayX];
    return id;
}

function keyPressed() {
    player.changeEnvironment();
}


function setOverlayAtPosition(id, screenX, screenY) {
    // convert screen coordinates into array coordinates
    let arrayX = int((screenX - offsetX) / worldTileSize);
    let arrayY = int((screenY - offsetY) / worldTileSize);

    if (world[arrayY][arrayX] != undefined) {
        overlay[arrayY][arrayX] = id;
    }
}

function isSolid(id) {
    // return true for all solid tiles
    if (id === 13 || id == 2370 || id == 3998 || id == 3999 || id == 3850 || id == 3851 || id == 4297 || id == 4296 ||
        id == 4446 || id == 4440 || id == 4441 || id == 4299 || id == 4005 || id == 4006 || id == 4591 || id == 2725
        || id == 2873 || id == 6958 || id == 7106 || id == 7254 || id == 4155 || id == 3857 || id == 3856 || id == 2376 || id == 459 || id == 4593) {
        return true;
    }
    return false;
}

function isInteractable(id) {

}

class Player {
    constructor(x, y) {
        this.x = x;
        this.y = y;
        this.speed = 5;
        // 0 = down
        // 1 = right
        // 2 = left
        // 3 = up
        this.direction = 0;
        this.walking = true;

        this.totalFrames = 4;
        this.currentFrame = 0;
        this.pauseCounter = 0;
        this.pauseCounterMax = 20;

        this.facingTile = [];
    }

    computeSensors() {
        this.middleX = int(this.x + worldTileSize / 2);
        this.middleY = int(this.y + worldTileSize / 2);
        this.left = int(this.x - 2);
        this.right = int(this.x + worldTileSize + 2);
        this.up = int(this.y - 2);
        this.down = int(this.y + worldTileSize + 2);
    }

    changeEnvironment() {
        // manipulate the environment with the space key
        if (keyIsDown(32)) {
            // if there's nothing here we should add something
            if (getOverlayTileAtPosition(this.middleX, this.middleY) == -1) {
                // adjust what's in the array here
                setOverlayAtPosition(int(random(1, 5)), this.middleX, this.middleY);
            }
            else {
                setOverlayAtPosition(-1, this.middleX, this.middleY);
            }
        }
    }

    moveAndDisplay() {
        this.facing = [];
        this.computeSensors();
        this.walking = false;

        if (keyIsDown(68)) {
            ellipse(this.right, this.middleY, 5, 5);
            let id = getWorldTileAtPosition(this.right, this.middleY);
            this.facing.push(id);
            // console.log(id);
            if (!isSolid(id)) {
                if (offsetX > minOffsetX && this.x === (width / 2)) {
                    // console.log(offsetX, (width) - (world[0].length * worldTileSize));
                    offsetX -= this.speed;
                } else {
                    this.x += this.speed;
                }
            }
            if (!keyIsDown(87) && !keyIsDown(83)) {
                this.direction = 1;
            }
            this.walking = true;
        }
        if (keyIsDown(65)) {
            ellipse(this.left, this.middleY, 5, 5);
            let id = getWorldTileAtPosition(this.left, this.middleY);
            this.facing.push(id);
            // console.log(id);
            if (!isSolid(id)) {
                if (offsetX < 0 && this.x === (width / 2)) {
                    offsetX += this.speed;
                } else {
                    this.x -= this.speed;
                }
            }
            if (!keyIsDown(87) && !keyIsDown(83)) {
                this.direction = 2;
            }
            this.walking = true;
        }
        if (keyIsDown(87)) {
            ellipse(this.middleX, this.up, 5, 5);
            let id = getWorldTileAtPosition(this.middleX, this.up);
            this.facing.push(id);
            if (!isSolid(id)) {
                if (offsetY < 0 && this.y === (height / 2)) {
                    offsetY += this.speed;
                } else {
                    this.y -= this.speed;
                }
            }
            if (!keyIsDown(68) && !keyIsDown(65)) {
                this.direction = 3;
            }
            this.walking = true;
        }
        if (keyIsDown(83)) {
            ellipse(this.middleX, this.down, 5, 5);
            let id = getWorldTileAtPosition(this.middleX, this.down);
            this.facing.push(id);
            if (!isSolid(id)) {
                if (offsetY > minOffsetY && this.y === (height / 2)) {
                    offsetY -= this.speed;
                } else {
                    this.y += this.speed;
                }
            }
            if (!keyIsDown(68) && !keyIsDown(65)) {
                this.direction = 0;
            }
            this.walking = true;
        }
        if (keyIsDown(13)) {
            this.facing.forEach(tileId => {

            })
        }

        if (this.walking) {
            // frame animation
            this.pauseCounter--;

            if (this.pauseCounter <= 0) {
                this.currentFrame += 1;
                if (this.currentFrame >= this.totalFrames) {
                    this.currentFrame = 0;
                }
                this.pauseCounter = this.pauseCounterMax;
            }

            drawTile(playerArtwork, (this.direction * 4) + this.currentFrame, 32, 64, this.x, this.y);
        } else {
            drawTile(playerArtwork, (this.direction * 4), 32, 64, this.x, this.y);
        }
    }
}
